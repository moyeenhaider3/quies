---
phase: 09-ux-polish-author
plan: 04
type: execute
wave: 2
depends_on: ["09-01", "09-03"]
files_modified:
  - lib/features/quotes/presentation/widgets/author_detail_modal.dart
  - lib/features/quotes/presentation/widgets/quote_card.dart
autonomous: true

must_haves:
  truths:
    - "Author detail modal opens when tapping author name on QuoteCard"
    - "Author detail modal opens when tapping Author button in action row"
    - "Modal shows author name, description, bio, quote count"
    - "Modal shows horizontal swipeable quote carousel"
    - "Tapping a quote in carousel opens full-screen single-quote detail"
    - "Modal shows shimmer loading state while fetching author data"
    - "Modal adapts to dark/light theme"
    - "Close button (√ó) appears centered below the modal"
  artifacts:
    - path: "lib/features/quotes/presentation/widgets/author_detail_modal.dart"
      provides: "AuthorDetailModal widget with author info + quote carousel"
    - path: "lib/features/quotes/presentation/widgets/quote_card.dart"
      provides: "Author button in action row + author name tap handler"
  key_links:
    - from: "lib/features/quotes/presentation/widgets/quote_card.dart"
      to: "lib/features/quotes/presentation/widgets/author_detail_modal.dart"
      via: "showGeneralDialog call on author name tap and author button tap"
      pattern: "showGeneralDialog|AuthorDetailModal"
    - from: "lib/features/quotes/presentation/widgets/author_detail_modal.dart"
      to: "lib/features/quotes/domain/repositories/quote_repository.dart"
      via: "repository.getAuthorBySlug(slug) for author data fetch"
      pattern: "getAuthorBySlug"
    - from: "lib/features/quotes/presentation/widgets/author_detail_modal.dart"
      to: "lib/presentation/widgets/shimmer/shimmer_quote_card.dart"
      via: "shimmer loading state while fetching"
      pattern: "ShimmerQuoteCard|ShimmerLine"
---

<objective>
Build the author detail modal with quote carousel and add author access points to QuoteCard (author name tap + author button in action row).

Purpose: Users should be able to explore an author's profile and browse their quotes ‚Äî deepening engagement with content beyond individual quotes.
Output: AuthorDetailModal widget + updated QuoteCard with 2 author access points.
</objective>

<execution_context>
@.planning/phases/09-ux-polish-author/09-CONTEXT.md
@.planning/phases/09-ux-polish-author/09-RESEARCH.md
</execution_context>

<context>
@.planning/PROJECT.md

Key files to read:
@lib/features/quotes/presentation/widgets/quote_card.dart (action row L175-220, author text L78-89)
@lib/features/quotes/domain/entities/quote.dart (authorSlug field ‚Äî added in Plan 03)
@lib/features/quotes/data/models/author_detail_model.dart (AuthorDetailModel: author + quotes)
@lib/features/quotes/data/models/author_model.dart (AuthorModel: name, slug, bio, description, quoteCount)
@lib/features/quotes/domain/repositories/quote_repository.dart (getAuthorBySlug method)
@lib/features/quotes/data/repositories/quote_repository_impl.dart (implementation)
@lib/presentation/widgets/shimmer/shimmer_quote_card.dart (from Plan 01)
@lib/presentation/widgets/shimmer/shimmer_line.dart (from Plan 01)
@lib/core/di/ (for get_it service locator to access repository)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AuthorDetailModal widget</name>
  <files>lib/features/quotes/presentation/widgets/author_detail_modal.dart</files>
  <action>
Create `AuthorDetailModal` as a StatefulWidget in `lib/features/quotes/presentation/widgets/author_detail_modal.dart`.

**Constructor parameters:**
- `required String authorSlug` ‚Äî used to fetch author data
- `required String authorName` ‚Äî shown immediately as title while loading

**State management:**
- Use local state (not BLoC) since this is transient modal UI
- `AuthorDetailModel? _authorDetail` ‚Äî null until loaded
- `bool _isLoading = true`
- `String? _error`

**initState:**
- Call `_fetchAuthor()` which uses `GetIt.instance<QuoteRepository>().getAuthorBySlug(authorSlug)`
- On success: `setState(() { _authorDetail = result; _isLoading = false; })`
- On failure: `setState(() { _error = 'Could not load author'; _isLoading = false; })`
- Import `get_it` and `QuoteRepository` for DI access

**Build method ‚Äî returns a full-screen Stack:**
- `GestureDetector` with `onTap: Navigator.pop` as backdrop (barrier dismiss)
- Center child: `Column(mainAxisSize: MainAxisSize.min)` containing:
  - **Modal container**: `Container` with height `MediaQuery.of(context).size.height * 0.8`, width `MediaQuery.of(context).size.width - 48` (24px margin each side), decoration with rounded corners (20px), theme-aware background color (dark: `Color(0xFF1A1A2E)`, light: `Colors.white`), border (`Colors.white.withValues(alpha: 0.08)` dark / `Colors.black.withValues(alpha: 0.06)` light)
  - **Close button**: `SizedBox(height: 16)` spacer + `IconButton(icon: Icon(Icons.close_rounded), onPressed: Navigator.pop)` with white/black70 color by theme, 48px container

**Modal interior layout (inside ClipRRect for rounded corners):**

When `_isLoading`:
- Padding 24px all sides
- `ShimmerLine(width: 200, height: 24)` for name
- `SizedBox(height: 12)`
- `ShimmerLine(width: 160, height: 14)` for description
- `SizedBox(height: 20)`
- `ShimmerLine(width: double.infinity, height: 14)` √ó 3 with 8px spacing for bio
- `Spacer()`
- `ShimmerQuoteCard()` sized to ~60% remaining height for carousel placeholder

When `_error != null`:
- Center with error message text

When loaded (`_authorDetail != null`):
- `SingleChildScrollView` (scrollable if bio is long) in `Expanded` wrapping:
  - Padding 24px horizontal, 20px top
  - **Author name**: `Text(author.name)` with `GoogleFonts.playfairDisplay(fontSize: 26, fontWeight: FontWeight.bold)`, color theme-aware
  - `SizedBox(height: 8)`
  - **Description**: `Text(author.description)` with `GoogleFonts.outfit(fontSize: 14, color: mutedColor)` where mutedColor is `Colors.white54` dark / `Colors.black45` light
  - `SizedBox(height: 16)`
  - **Bio**: `Text(author.bio)` with `GoogleFonts.outfit(fontSize: 14, height: 1.6, color: textColor)` where textColor is `Colors.white70` dark / `Colors.black87` light
  - `SizedBox(height: 16)`
  - **Quote count badge**: `Container` with `EdgeInsets.symmetric(horizontal: 12, vertical: 6)`, rounded corners 12, background `AppTheme.calmTeal.withValues(alpha: 0.15)`, child `Text('üìù ${author.quoteCount} quotes')` in Outfit 13px, `AppTheme.calmTeal` color
  - `SizedBox(height: 20)`
- **Quote carousel** (NOT inside SingleChildScrollView ‚Äî placed separately below):
  - `SizedBox` with height = 60% of modal height
  - `PageView.builder` with `itemCount: _authorDetail!.quotes.length`, `controller: PageController(viewportFraction: 0.85)`
  - Each item: `Padding(padding: EdgeInsets.symmetric(horizontal: 8))` ‚Üí `GestureDetector(onTap: _openQuoteDetail)` ‚Üí  `Container` with rounded corners 16, gradient background (use `AppTheme.getGradientForId(quote.id)` ‚Äî same as QuoteCard), child with quote text (Playfair Display 20px, white) + tags row (Wrap of small chips, same style as QuoteCard tags)
  - `_openQuoteDetail(RemoteQuote rq)`: convert to Quote via `rq.toQuote()`, push a simple full-screen `Scaffold` showing the quote. Use `Navigator.of(context).push(MaterialPageRoute(...))`. The detail screen is a simple centered layout: gradient background, quote text, author, tags ‚Äî reuse QuoteCard essentially but without action buttons. Keep it simple ‚Äî a Center column with text.

**Static helper to show the modal:**
```dart
static void show(BuildContext context, {required String authorSlug, required String authorName}) {
  showGeneralDialog(
    context: context,
    barrierDismissible: true,
    barrierLabel: 'Author detail',
    barrierColor: Colors.black54,
    transitionDuration: const Duration(milliseconds: 300),
    transitionBuilder: (context, anim, secondAnim, child) {
      return FadeTransition(opacity: anim, child: child);
    },
    pageBuilder: (context, anim1, anim2) {
      return AuthorDetailModal(authorSlug: authorSlug, authorName: authorName);
    },
  );
}
```

**Important:** Use `showGeneralDialog` NOT `showModalBottomSheet` ‚Äî this is a modal overlay, not a bottom sheet (avoids drag-to-dismiss behavior per context decisions).
  </action>
  <verify>
Run `dart analyze lib/features/quotes/presentation/widgets/author_detail_modal.dart` ‚Äî no errors.
Verify widget has: shimmer loading state, author info section, quote carousel with PageView.builder, close button below modal, static `show()` method.
  </verify>
  <done>AuthorDetailModal created with loading shimmer, author info display, horizontal quote carousel, full-screen detail on tap, and close button.</done>
</task>

<task type="auto">
  <name>Task 2: Add author access points to QuoteCard</name>
  <files>lib/features/quotes/presentation/widgets/quote_card.dart</files>
  <action>
Add two access points for the author detail modal in QuoteCard:

**1. Author name tap (L78-89 area):**
- Wrap the existing author `Text("- ${quote.author}", ...)` in a `GestureDetector`
- `onTap`: if `quote.authorSlug != null`, call `AuthorDetailModal.show(context, authorSlug: quote.authorSlug!, authorName: quote.author)`
- If `authorSlug` is null (local quotes), do nothing (no-op)
- Keep the existing `.animate()` chain after the GestureDetector

**2. Author button in action row (after Save button, L200-218 area):**
- Add a 4th `_buildActionButton` call after the Save button:
  ```dart
  _buildActionButton(
    context,
    icon: Icons.person_outline_rounded,
    label: 'Author',
    onTap: () {
      if (quote.authorSlug != null) {
        AuthorDetailModal.show(context, authorSlug: quote.authorSlug!, authorName: quote.author);
      }
    },
    delay: 1100.ms,
  ),
  ```
- The action row now has 4 buttons: Share, Like, Save, Author ‚Äî `spaceEvenly` handles spacing automatically

**3. Add import** at top of file:
`import 'author_detail_modal.dart';`

**Important:** Only show Author button functionality when `authorSlug` is available. For local quotes (authorSlug null), the button can still appear but tapping does nothing ‚Äî OR hide it with `if (quote.authorSlug != null)` conditional. Prefer showing it always for consistent layout, with no-op on null slug.
  </action>
  <verify>
Run `dart analyze lib/features/quotes/presentation/widgets/quote_card.dart` ‚Äî no errors.
Verify action row has 4 buttons: Share, Like, Save, Author.
Verify author name text is tappable.
  </verify>
  <done>QuoteCard has 2 author access points: tappable author name + Author button in action row. Both open AuthorDetailModal when authorSlug is available.</done>
</task>

</tasks>

<verification>
1. `dart analyze lib/` passes with no errors
2. AuthorDetailModal opens via `showGeneralDialog` (not bottom sheet)
3. Modal shows shimmer while loading, then author info + quote carousel
4. Author info includes: name (large), description (muted), bio (paragraph), quote count badge
5. Quote carousel is horizontal PageView with gradient cards
6. Tapping carousel quote opens full-screen detail view
7. Close button (√ó) centered below modal
8. QuoteCard action row: Share, Like, Save, Author (4 buttons)
9. Tapping author name on card opens modal
10. Modal theme-adapts (dark: #1A1A2E bg, light: white bg)
</verification>

<success_criteria>
- Author detail modal is fully functional with data fetch, display, and carousel
- Two access points on QuoteCard work correctly
- Shimmer loading state matches plan 01 components
- dart analyze clean
</success_criteria>

<output>
After completion, create `.planning/phases/09-ux-polish-author/09-04-SUMMARY.md`
</output>
